#!/bin/sh
# commit-msg hook - validates commit message format using commitlint

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo "${BLUE}Validating commit message...${NC}"

# Run cspell to check for typos in commit message
echo "Checking spelling..."
CSPELL_OUTPUT=$(cat "$1" | npx --no -- cspell stdin --no-progress --no-summary 2>&1)
CSPELL_EXIT_CODE=$?

if [ $CSPELL_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "${RED}Spelling issues found in commit message:${NC}"
    echo "$CSPELL_OUTPUT"
    echo ""
    echo "If these are valid words, add them to ${YELLOW}cspell.config.json${NC} or ${YELLOW}project-dictionary.txt${NC}"
    echo ""
    echo "To bypass (not recommended): ${YELLOW}git commit --no-verify${NC}"
    exit 1
fi

# Run commitlint on the commit message
npx --no -- commitlint --edit "$1"

COMMITLINT_EXIT_CODE=$?

if [ $COMMITLINT_EXIT_CODE -eq 0 ]; then
    echo "${GREEN}Commit message is valid${NC}"
    exit 0
else
    echo ""
    echo "${RED}Commit message does not follow conventional commit format${NC}"
    echo ""
    echo "Expected format: ${YELLOW}<type>(<scope>): <subject>${NC}"
    echo ""
    echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
    echo ""
    echo "Examples:"
    echo "  ${GREEN}feat(auth): add login form validation${NC}"
    echo "  ${GREEN}fix: resolve memory leak in sidebar${NC}"
    echo "  ${GREEN}docs: update API documentation${NC}"
    echo ""
    echo "To bypass (not recommended): ${YELLOW}git commit --no-verify${NC}"
    exit 1
fi
